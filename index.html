<!DOCTYPE html>
<html>

<head>
    <title>We give loan</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <script src="" type="text/javascritpt"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">




    <link rel="stylesheet" href="./css/calculator.css">

</head>

<body>
    <div class="container fluid">
        <header>

            <!-- <div class="header_bg"></div>
            <div class="header_bg1"></div> -->
            <section id="video-view">

                <div class="banner-canvas">
                    <div class="video-header viewport-header">
                        <h1>We give loan</h1>
                        <!-- <h2 class="hero-title h2-mobile mt-0 is-revealing">Landing template for startups</h1> -->
                        <p><span class="viewport-slogan">Apply for 100€, 300€ up 6000€</span><br></p>
                        <p class=""><a class="btn apply-button" href="#loan-space">Apply Now </a></p>
                        <p class="viewport-slogan">Relax enjoy Your tea while we provide cash</p>
                        <p>
                            appicatnts can apply <br>
                            and based on the application data, we evaluate for our major lenders, they select
                            customer and gives loan
                        </p>
                    </div>
                    <div class="fullscreen-bg">
                        <video loop muted autoplay poster="img/videoframe.jpg" class="fullscreen-bg__video">
                            <source src="video/big_buck_bunny.webm" type="video/webm">
                            <source src="video/pexelsVideos1.mp4" type="video/mp4">
                            <source src="video/big_buck_bunny.ogv" type="video/ogg">
                        </video>
                    </div>
                </div>

            </section>
        </header>

        <!-- <div class="row ">
            <div class="col col-4 item-3"> </div>
            <div class="col col-6 item-3"></div>
        </div> -->

        <section id="loan-space">
            <div class="row">
                <label class=" form-header"></label>
            </div>

            <!-- form info left pannel -->
            <div class="row reg-form">
                <div class="col col-2 form-left-pannel">
                    <div style="margin-top: 40px; ">
                        <label class=" form-info "> Installment amount: </label>
                        <label><span id="result"></span></label>
                        <hr>
                        <label class=" form-info "> Total Installment: </label>
                        <label><span id="num_installment"></span></label>
                        <hr>
                        <label class=" form-info "> Interest: </label>
                        <label><span id="num_interest"></span></label>
                        <hr>
                    </div>
                </div>
                <!-- end of form info form-left-pannel -->
                <div class="col col-6">
                    <label class="form-header">Repaymnet Calculator:</label>

                    <form id="loan_form" name="loan_form">

                        <!-- start of first tab -->
                        <div class="tab">
                            <div class="form-group row"="">
                                <label for="email_address">Email</label>
                                <input type="email" class="form-control" id="email_address" name="email_address" value=""
                                    placeholder="john@example.com" onfocus="selectedInput(this.id)" required>
                                <label name="validate_label"></label>
                            </div>
                            <div class="form-group row">
                                <label for="amount_range"> Choose Loan Amount:</label>

                                <input type="range" min="300" max="6000" step="300" value="300" class="slider" id="amount_range"
                                    name="loan_amount">
                                <span id="amount_value"="color:gray; font-size:25px;"></span>
                            </div>

                            <div class="form-group row">
                                <label for="installment_range"> Installment:</label> *
                                <input type="range" min="1" max="60" value="2" class="slider" id="installment_range"
                                    name="installment_range">
                                <span id="installment_value"></span>
                            </div>

                            <div class="form-group row">
                                <label for="installments">Min Installment Amount</label>
                                <input type="text" class="form-control" id="min_installment" value="" placeholder="Min Installments"
                                    required name="min_installment">
                            </div>

                            <div class="row form-check form-check-inline">
                                <label class="form-check-label" for="employment_status">
                                    Employed?
                                    [yes to check]
                                    <input class="form-check-input" type="checkbox" value="" id="employment_status"
                                        name="employment_status">
                            </div>
                        </div>
                        <!-- end of first tab -->

                        <!-- start of second tab -->
                        <div class="tab">
                            <div class="form-group row">
                                <label for="f_name">Name</label>
                                <input type="text" class="form-control" id="f_name" value="" placeholder="First Name"
                                    name="f_name">
                            </div>

                            <div class="form-group row">
                                <label for="l_name">Last Name</label>
                                <input type="text" class="form-control" id="l_name" value="" placeholder="Last Name"
                                    name="l_name">
                            </div>

                            <div class="form-group row">
                                <label for="address">Address </label>
                                <input type="text" class="form-control" id="address" value="" placeholder="Your Address here"
                                    name="address">
                            </div>
                        </div>
                        <!-- end of second tab -->
                        <div class="form-group">
                            <div>

                                <button id="previous_button" type="button" onclick="previousPage()" class="btn custom-button">
                                    << Previous </button> <button id="next_button" type="button" onclick="nextPage()"
                                        class="btn btn-info">
                                        Next>>
                                </button>
                            </div>
                            <div class="">
                                <span class="step"></span>
                                <span class="step"></span>
                            </div>
                        </div>
                    </form>

                </div>

                <div class="col col-4 d-flex ">
                    <div class="card text-white  bg-infor card-shadow">
                        <div class="card-header"><span>! An amortized loan is a loan with
                                scheduled periodic
                                payments that are applied to both principal and interest.</span></div>
                        <div class="card-body ">
                            <h5 class="card-title">How to apply !</h5>
                            <p class="card-text">

                            </p>
                            <p class="card-text">
                                <li>Choose appropriate loan amount and installment.</li>
                                <li>Fill-in email and Minimum Installment amount.</li>
                                <li>Click the next button </li>
                            </p>
                        </div>
                    </div>

                </div>
            </div> <!-- End of the form blcok-->
        </section>
        <!-- <div class="box-spacer"></div>
        <section id="middle-view">

            <div class="row">
                <div class="col col-12 d-flex ">
                    <aside>
                        <h5>About !</h5>
                        <p>We provide our customer evalution if they are elligible for loan or not .</p>
                    </aside>
                    <aside>
                        <h5>How we operate</h5>
                        <p>
                            How we operate in the loan sector is this a
                            proper way to identify
                        </p>
                    </aside>
                    <aside>
                        <h5>Get in touch with us</h5>
                        <p>
                            Contac us as your convenient.
                        </p>
                    </aside>
                </div>

            </div>
            <div class="box-spacer"></div> -->
        <footer id="footer-view">
            <!-- Footer -->
            <!-- <footer class="page-footer pt-4"> -->
            <!-- Footer Links -->
            <div class="container page-footer text-center text-md-left">
                <!-- Footer links -->
                <div class="row text text-md-left mt-3 pb-3">

                    <!-- Grid column -->
                    <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mt-3">
                        <h6 class="text-uppercase mb-4">We give loan-form</h6>
                        <hr>
                        <p>This Page provides some basic info.</p>
                    </div>
                    <!-- Grid column -->

                    <hr class="w-100 clearfix d-md-none">

                    <!-- Grid column -->
                    <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mt-3">
                        <h6 class="text-uppercase mb-4">Products</h6>
                        <hr>
                        <p>
                            <li><a href="#!">Short Term Loan</a></li>
                        </p>
                        <p>
                            <li><a href="#!">Consumer Loan</a></li>
                        </p>
                        <p>
                            <li><a href="#!">Housing Loan</a></li>
                        </p>
                        <p>
                            <li><a href="#!">Flexi Loan</a></li>
                        </p>
                    </div>
                    <!-- Grid column -->

                    <hr class="w-100 clearfix d-md-none">

                    <!-- Grid column -->
                    <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mt-3">
                        <h6 class="text-uppercase mb-4 ">Useful links</h6>
                        <hr>
                        <p>
                            <a href="#!">Your Account</a>
                        </p>
                        <p>
                            <a href="#!">Terms and Conditions</a>
                        </p>
                        <p>
                            <a href="#!">Billing</a>
                        </p>
                        <p>
                            <a href="#!">Help</a>
                        </p>
                    </div>

                    <!-- Grid column -->
                    <hr class="w-100 clearfix d-md-none">

                    <!-- Grid column -->
                    <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mt-3">
                        <h6 class="text-uppercase mb-4">Contact</h6>
                        <hr>
                        <p>
                            <i class="fas fa-home mr-3"></i> Some place, PL 10012, UK</p>
                        <p>
                            <i class="fas fa-envelope mr-3"></i> info@wegiveloan.co.uk</p>
                        <p>
                            <i class="fas fa-phone mr-3"></i> + 358 015 5555</p>
                        <p>
                            <i class="fas fa-print mr-3"></i> + 358 015 5555</p>
                    </div>
                    <!-- Grid column -->

                </div>
                <!-- Footer links -->

                <hr>

                <!-- Grid row -->
                <div class="row d-flex align-items-center">

                    <!-- Grid column -->
                    <div class="col-md-7 col-lg-8">

                        <!--Copyright-->
                        <p class="text-center text-md-left">© 2019 Copyright:
                            <a href="#">
                                <strong> weGiveLoan.co.uk</strong>
                            </a>
                        </p>

                    </div>
                    <!-- Grid column -->

                    <!-- Grid column -->
                    <div class="col-md-5 col-lg-4 ml-lg-0">

                        <!-- Social buttons -->
                        <div class="text-center text-md-right">
                            <ul class="list-unstyled list-inline">
                                <li class="list-inline-item">
                                    <a class="btn-floating btn-sm rgba-white-slight mx-1">
                                        <i class="fab fa-facebook-f"></i>
                                    </a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="btn-floating btn-sm rgba-white-slight mx-1">
                                        <i class="fab fa-twitter"></i>
                                    </a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="btn-floating btn-sm rgba-white-slight mx-1">
                                        <i class="fab fa-google-plus-g"></i>
                                    </a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="btn-floating btn-sm rgba-white-slight mx-1">
                                        <i class="fab fa-linkedin-in"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- Grid column -->
                </div>
                <!-- Grid row -->
            </div>
            <!-- Footer Links -->
        </footer>
        <!-- Footer -->
    </div>
    </section>
    <!--container ends here -->


    <!-- <script src="./src/main.js" type="text/javascript"> -->
    <script>

        // variables Global
        const state = {
            next_button: 1,
            previous_button: 0,
            tab_lenth: 0,
            current_tab: 0,
            valid: false,
            responseObject: {},
            thisObject: {},
        }
        var URL = "http://localhost:3000"
        var loanForm = document.loan_form;

        init()
        var loanSlider = document.getElementById('amount_range');
        var amountValue = document.getElementById('amount_value');
        // default value on load
        amountValue.innerHTML = loanSlider.value;

        var installmentSlider = document.getElementById("installment_range");
        var installmentValue = document.getElementById("installment_value");
        // Display the default slider value onload
        installmentValue.innerHTML = installmentSlider.value;

        loanSlider.oninput = function () {
            amountValue.innerHTML = this.value;
            calculateLoan();
        }

        // Update the current slider value (each time you drag the slider handle)
        installmentSlider.oninput = function () {
            installmentValue.innerHTML = this.value;
            calculateLoan()
        }

        function selectedInput(id) {
            // here we check input values and field comparison
            // this.style.bacground="red";

            const ty = document.getElementById(id);
            ty.className = "form-control form-group-border"
            document.getElementById(id).className = "form-control "
        }
        function allFormData(form) {
            return Object.values(form)
                .reduce((obj, field) => {
                    obj[field.name] = field.value; return obj
                }, {})

        }
        function postData(data) {
            console.log('post data fired', allFormData(data))
            // TODO:: Implement post with fetch !!
            fetch(URL, {
                method: "POST",
                body: JSON.stringify(allFormData(data))
            }).then(res => {
                state.responseObject = res;
                console.log(res)
            });
        }
        function sendMail(formData) {
            // formData.map(e=>console.log(e))

            //TODO: this should be implemented soon
            // customer email sendin implementation from server-side 
        }

        function ifEmployd(checkbox) {
            if (checkbox == true) return 1;
            else return 0;
        }
        // var thisObject = {};
        function currentFormObject(obj) {
            var thisObject = obj.getElementsByClassName('tab');
            state.thisObject = thisObject;
            // console.log(thisObject)ss
            return thisObject;
        }
        function formFieldCheck(form = {}) {

            // const tabs = currentFormObject(form);
            // console.log('show current', tabs[state.current_tab])
            let email = form.email_address.value;//check email regex
            let min_installment_amount = form.min_installment.value;
            const employmentStatus = ifEmployd(form.employment_status.checked); // if checked 1 else 0

            if (state.current_tab == 0) {
                if (!form.email_address.value || !form.min_installment.value) {
                    // form.validate_input.nextSibling.innerHTML="must";
                    // console.log('inside the first fucntion')
                    form.email_address.className = " form-control invalid";
                    form.min_installment.className = "form-control invalid"
                    return false;
                }
            }

            if (state.current_tab == 1) {
                if (!form.f_name.value || !form.l_name.value || !form.address.value) {
                    form.f_name.className = " form-control invalid";
                    form.l_name.className = " form-control invalid";
                    form.address.className = " form-control invalid";
                    return false;
                }
            }
        }

        function calculateLoan() {
            let interest = 6;

            // INFO :: if this checks ok
            var installmentMinAmount = loanForm.min_installment;
            const interest_rate = (interest / 100) / 12;
            var loan_amount = loanSlider.value || "provide value";
            var installment_min = installmentMinAmount.value || 50;
            var repay_duration = installmentSlider.value || "provide value";
            var form = document.getElementById('loan-form');

            /**
             * Loan Payment = Amount / Discount Factor or P = A / D
             * Discount Factor (D) = {[(1 + i) ^n] - 1} / [i(1 + i)^n] 
            */
            var discount_factor =
                (Math.pow((1 + interest_rate), repay_duration) - 1) /
                (interest_rate * Math.pow((1 + interest_rate), repay_duration));
            var repay = Math.round(loan_amount / discount_factor) || "Please fill all the amount";
            document.getElementById("result").innerHTML = repay + "€/Month";
            document.getElementById('num_installment').innerHTML = repay_duration;
            document.getElementById('num_interest').innerHTML = interest + ' %';

        }

        /*
        form View satrt
        */
        function increament() {
            for (; state.current_tab <= state.tab_lenth - 2;) {
                state.current_tab = state.current_tab + 1;
                return true;
            }
        }

        function decrement() {
            state.current_tab = state.current_tab - 1;
            return true;
        }

        function nextPage() {
            if (formFieldCheck(document.loan_form) === false) return 0; // check fields if false stay in the page
            increament();
            var tabs = document.getElementsByClassName('tab');
            tabs[state.current_tab - 1].style.display = "none";
            postData(loanForm)
            formPageView(state.current_tab)
        }

        function previousPage() {
            decrement();
            if (formFieldCheck(document.loan_form) === false) return 0; // check fields if false stay in the page

            var tabs = document.getElementsByClassName('tab');
            tabs[state.current_tab + 1].style.display = "none";
            formPageView(state.current_tab);
        }


        function stepIndicator(current_step) {
            var i, steps = document.getElementsByClassName("step");
            for (i = 0; i < steps.length; i++) {
                steps[i].className = steps[i].className.replace(" active", "");
            }
            steps[current_step].className += " active";
        }

        function formPageView(tab_index) {
            var tabs = document.getElementsByClassName('tab');
            state.tab_lenth = tabs.length;
            // return ; 
            if (tab_index == -1) return false;
            tabs[tab_index].style.display = "block";
            if (tab_index == 0) {
                document.loan_form.previous_button.style.display = "none";
            } else {
                document.loan_form.previous_button.style.display = "inline";
            }
            if (tab_index == state.tab_lenth - 1) {
                document.loan_form.next_button.innerHTML = "Submit";
                // document.loan_form.next_button.addEventListener('click',sendMail);
            } else {
                document.loan_form.next_button.innerHTML = "Next >>"
            }
            stepIndicator(state.current_tab)
        }

        function init() {
            formPageView(state.current_tab)
        }
        /*form view end*/
    </script>
</body>

</html>