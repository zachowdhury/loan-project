<!DOCTYPE html>
<html>

<head>
    <title>We give loan</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <script src="" type="text/javascritpt"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/calculator.css">


</head>

<body>
    <div class="container fluid">
        <header style="margin-bottom:-400px;">
            <div class="header_bg"></div>
            <div class="header_bg1"></div>
            <h1>We give loan</h1>

            <section class="  text-center">
                <div class="container-sm">
                    <div class="hero-inner">
                        <!-- <h2 class="hero-title h2-mobile mt-0 is-revealing">Landing template for startups</h1> -->
                        <p class="hero-paragraph is-revealing">Our Calculation is accurate, with one analysis we can
                            process
                            several banks to be paid to you.</p>
                        <p class="hero-cta is-revealing"><a class="button button-secondary button-shadow" href="#loan-space">Get
                                started now</a></p>
                        <div class="hero-media">
                        </div>
                    </div>
                </div>
            </section>
        </header>
        <div class="row">
            <svg width="132" height="40" xmlns="http://www.w3.org/2000/svg">
            </svg>
        </div>

        <section id="loan-space"></section>
        <div class=" row" style="margin:15px;" style="display:'';">
            <div class="form col col-8 d-flex  card-shadow">
                <form id="loan_form" class=" p-2" name="loan_form">
                    <div class="form-group">
                        <label class=" form-header">Repayment Calculator</label>
                        <label class=" form-header "> Installment amount: </label>
                        <label><span style="color:gray" id="result"></span></label>

                        <label class=" form-header "> Total Installment: </label>
                        <label><span style="color:gray" id="num_installment"></span></label>

                        <label class=" form-header "> Interest: </label>
                        <label><span style="color:gray" id="num_interest"></span></label>
                    </div>
                    <!-- start of first tab -->
                    <div class="tab">
                        <div class="box-border">
                            <div class="form-group row">
                                <label for="email_address">Email</label>
                                <input type="email" class="form-control" id="email_address" name="email_address" value=""
                                    placeholder="john@example.com" required>
                                <label name="validate_label"></label>
                            </div>
                            <div class="form-group row">
                                <label for="amount_range"> Choose Loan Amount:</label>

                                <input type="range" min="300" max="6000" step="300" value="300" class="slider" id="amount_range"
                                    name="loan_amount">
                                <span id="amount_value" style="color:gray; font-size:25px;"></span>
                            </div>

                            <div class="form-group row">
                                <label for="installment_range"> Installment:</label> *
                                <input type="range" min="1" max="60" value="2" class="slider" id="installment_range"
                                    name="installment_range">
                                <span id="installment_value" style="color: gray; font-size:25px;"></span>
                            </div>

                            <div class="form-group row">
                                <label for="installments">Min Installment Amount</label>
                                <input type="text" class="form-control" id="min_installment" value="" placeholder="Min Installments"
                                    required name="min_installment">
                            </div>

                            <div class="row form-check form-check-inline">
                                <label class="form-check-label" for="employment_status">
                                    Employed?
                                    [yes to check]
                                    <input class="form-check-input" type="checkbox" value="" id="employment_status"
                                        name="employment_status">
                            </div>
                        </div>
                    </div>
                    <!-- end of first tab -->
                    <!-- start of second tab -->
                    <div class="tab">
                        <div class="input-group">
                            <div class="form-group row">
                                <label for="f_name">Name</label>
                                <input type="text" class="form-control" id="f_name" value="" placeholder="First Name"
                                    name="f_name">
                            </div>

                            <div class="form-group row">
                                <label for="l_name">Last Name</label>
                                <input type="text" class="form-control" id="l_name" value="" placeholder="Last Name"
                                    name="l_name">
                            </div>

                            <div class="form-group row">
                                <label for="address">Address </label>
                                <input type="text" class="form-control" id="address" value="" placeholder="Your Address here"
                                    name="address">
                            </div>
                        </div>
                    </div>
                    <!-- end of second tab -->
                    <div class="form-group">
                        <div>

                            <button id="previous_button" type="button" onclick="previousPage()" class="btn custom-button">
                                << Previous </button> <button id="next_button" type="button" onclick="nextPage()" class="btn custom-button">
                                    Next>>
                            </button>
                        </div>
                        <div class="">
                            <span class="step"></span>
                            <span class="step"></span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col col-4 d-flex ">
                <section id="About-us" style="position:absolute">
                    <div class="card text-white bg-info card-shadow">
                        <div class="card-header"><span style="font-size:1em;">! An amortized loan is a loan with
                                scheduled periodic
                                payments that are applied to both principal and interest.</span></div>
                        <div class="card-body ">
                            <h5 class="card-title">How to apply !</h5>
                            <p class="card-text">

                            </p>
                            <p class="card-text">
                                <li>Choose appropriate loan amount and installment.</li>
                                <li>Fill-in email and Minimum Installment amount.</li>
                                <li>Click the next button </li>
                            </p>
                        </div>
                    </div>

                </section>
            </div>
        </div>

        <div class="row">
            <div class="col col-12 d-flex ">
                <aside>
                    <h1>About !</h1>
                    <p>We provide our customer evalution if they are elligible for loan or not .</p>
                </aside>
                <aside>
                    <h1>How we operate</h1>
                    <p>
                        How we operate in the loan sector is this a
                        proper way to identify
                    </p>
                </aside>
                <aside>
                    <h1>Get in touch with us</h1>
                    <p>
                        Contac us as your convenient.
                    </p>
                </aside>
            </div>

        </div>
        <footer>
            <p>Copyright 2019 we goive loan</p>
        </footer>
    </div>


    <!-- <script src="./src/main.js" type="text/javascript"> -->
    <script>

        // variables Global
        const state = {
            next_button: 1,
            previous_button: 0,
            tab_lenth: 0,
            current_tab: 0,
            valid: false,
            thisObject: {},
        }
        var loanForm = document.loan_form;

        init()
        var loanSlider = document.getElementById('amount_range');
        var amountValue = document.getElementById('amount_value');
        // default value on load
        amountValue.innerHTML = loanSlider.value;

        var installmentSlider = document.getElementById("installment_range");
        var installmentValue = document.getElementById("installment_value");
        // Display the default slider value onload
        installmentValue.innerHTML = installmentSlider.value;

        loanSlider.oninput = function () {
            amountValue.innerHTML = this.value;
            calculateLoan();
        }

        // Update the current slider value (each time you drag the slider handle)
        installmentSlider.oninput = function () {
            installmentValue.innerHTML = this.value;
            calculateLoan()
        }

        function postData( data ) {
            // TODO:: Implement post with fetch !!
            fetch("https://httpbin.org/post", {
                method: "POST",
                body: JSON.stringify("")
            }).then(res => {
                console.log("Request complete! response:", res);
            });
        }
        function sendMail(formData) {

            //TODO: this should be implemented soon
            // customer email sendin implementation from server-side 
        }

        function ifEmployd(checkbox) {
            if (checkbox == true) return 1;
            else return 0;
        }
        // var thisObject = {};
        function currentFormObject(obj) {
            var thisObject = obj.getElementsByClassName('tab');
            state.thisObject = thisObject;
            // console.log(thisObject)ss
            return thisObject;
        }
        function formFieldCheck(form = {}) {

            const tabs = currentFormObject(form);
            console.log('state', state.current_tab)
            console.log(tabs[state.current_tab])

            let email = form.email_address.value;//check email regex
            let min_installment_amount = form.valueOf().min_installment.value;
            let f_name = form.f_name.value;
            let l_name = form.l_name.value;
            let address = form.address.value;

            const employmentStatus = ifEmployd(form.employment_status.checked); // if checked 1 else 0

            if (!email || !min_installment_amount) {
                // form.validate_input.nextSibling.innerHTML="must";
                // console.log(form)
                form.email_address.className = "invalid";
                form.min_installment.className = "invalid"

                return false;
            }
        }

        function calculateLoan() {
            let interest = 6;

            // INFO :: if this checks ok
            var installmentMinAmount = loanForm.min_installment;
            const interest_rate = (interest / 100) / 12;
            var loan_amount = loanSlider.value || "provide value";
            var installment_min = installmentMinAmount.value || 50;
            var repay_duration = installmentSlider.value || "provide value";
            var form = document.getElementById('loan-form');

            /**
             * Loan Payment = Amount / Discount Factor or P = A / D
             * Discount Factor (D) = {[(1 + i) ^n] - 1} / [i(1 + i)^n] 
            */
            var discount_factor =
                (Math.pow((1 + interest_rate), repay_duration) - 1) /
                (interest_rate * Math.pow((1 + interest_rate), repay_duration));
            var repay = Math.round(loan_amount / discount_factor) || "Please fill all the amount";
            document.getElementById("result").innerHTML = repay + "€/Month";
            document.getElementById('num_installment').innerHTML = repay_duration;
            document.getElementById('num_interest').innerHTML = interest + ' %';

        }

        /*
        form View satrt
        */
        function nextPage() {
            increament();
            if (formFieldCheck(document.loan_form) === false) return 0; // check fields if false stay in the page
            var tabs = document.getElementsByClassName('tab');
            tabs[state.current_tab - 1].style.display = "none";
            postData(tabs)
            formPageView(state.current_tab)
        }

        function previousPage() {
            decrement();
            if (formFieldCheck(document.loan_form) === false) return 0; // check fields if false stay in the page

            var tabs = document.getElementsByClassName('tab');
            tabs[state.current_tab + 1].style.display = "none";
            formPageView(state.current_tab);
        }

        function increament() {
            for (; state.current_tab <= state.tab_lenth - 2;) {
                state.current_tab = state.current_tab + 1;
                return true;
            }
        }

        function decrement() {
            state.current_tab = state.current_tab - 1;
            return true;
        }

        function stepIndicator(current_step) {
            var i, steps = document.getElementsByClassName("step");
            for (i = 0; i < steps.length; i++) {
                steps[i].className = steps[i].className.replace(" active", "");
            }
            steps[current_step].className += " active";
        }

        function formPageView(tab_index) {

            var tabs = document.getElementsByClassName('tab');
            state.tab_lenth = tabs.length;
            // return ; 
            if (tab_index == -1) return false;
            tabs[tab_index].style.display = "block";
            if (tab_index == 0) {
                document.loan_form.previous_button.style.display = "none";
            } else {
                document.loan_form.previous_button.style.display = "inline";
            }
            if (tab_index == state.tab_lenth - 1) {
                document.loan_form.next_button.innerHTML = "Submint";
            } else {
                document.loan_form.next_button.innerHTML = "Next >>"
            }
            stepIndicator(state.current_tab)
        }

        function init() {
            formPageView(state.current_tab)
        }
        /*form view end*/
    </script>
</body>

</html>